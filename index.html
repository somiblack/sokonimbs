<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SokoniMbs - Buy Mbs ChapChap!</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .bundle-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .bundle-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .badge {
            font-size: 0.75rem;
            background-color: #facc15;
            color: #1f2937;
            padding: 2px 6px;
            border-radius: 9999px;
            margin-left: 0.5rem;
        }
        .whatsapp-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25D366;
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: transform 0.2s;
        }
        .whatsapp-float:hover {
            transform: scale(1.1);
        }
        
        /* Modal Styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Toast Styles */
        .toast {
            animation: toastSlideIn 0.3s ease-out;
        }
        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .toast.toast-exit {
            animation: toastSlideOut 0.3s ease-in;
        }
        @keyframes toastSlideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        /* Loading Spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #10b981;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Phone Input Styling */
        .phone-input {
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .phone-input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .phone-input.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        /* Button Animations */
        .btn-primary {
            transition: all 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .btn-secondary {
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        /* Tab Styles */
        .tab-button {
            transition: all 0.2s;
        }
        .tab-button.active {
            background-color: #10b981;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        /* Section Styles */
        .section-hidden {
            display: none;
        }
        
        /* Discount Badge */
        .discount-badge {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 12px;
            position: absolute;
            top: -8px;
            right: -8px;
            font-weight: bold;
        }
        
        /* Special Offer Cards */
        .special-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .renewable-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .minutes-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        /* Amount Input Styling */
        .amount-input {
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .amount-input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-100 font-sans">
    <header class="bg-gradient-to-r from-green-600 to-blue-500 text-white p-4 shadow-lg">
        <div class="max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center text-center sm:text-left">
            <h1 class="text-xl font-bold tracking-wide">SokoniMbs.co.ke</h1>
            <span class="text-sm italic mt-1 sm:mt-0">Buy Mbs ChapChap at Sokoni!</span>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 sm:p-6">
        <div class="mb-8 text-center">
            <h2 class="text-3xl font-bold text-green-700 mb-2">Available Offers</h2>
            <p class="text-gray-600">Affordable & Instant Safaricom Bundles, Airtime & Minutes</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap justify-center gap-2 mb-6">
                <button onclick="showSection('data')" class="tab-button active px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">Data Bundles</button>
                <button onclick="showSection('airtime')" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">Airtime Services</button>
                <button onclick="showSection('sms')" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">SMS Bundles</button>
                <button onclick="showSection('renewable')" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">Renewable Data</button>
                <button onclick="showSection('minutes')" class="tab-button px-4 py-2 rounded-lg font-medium bg-gray-200 text-gray-700">Minutes & Talktime</button>
            </div>
        </div>

        <!-- Data Bundles Section -->
        <div id="data-section" class="section">
            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">Data Offers - <span class="text-green-600">Hot Offers</span></h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1.25GB till Midnight</h3>
                        <p class="text-gray-800">Ksh 55</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1.25GB till Midnight', 55, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1.25GB till Midnight', 55, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1.2GB - 30 Days</h3>
                        <p class="text-gray-800">Ksh 250</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1.2GB - 30 Days', 250, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1.2GB - 30 Days', 250, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">350MB - Weekly</h3>
                        <p class="text-gray-800">Ksh 49</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('350MB - Weekly', 49, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('350MB - Weekly', 49, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1GB - 1 Hour</h3>
                        <p class="text-gray-800">Ksh 19</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1GB - 1 Hour', 19, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1GB - 1 Hour', 19, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">250MB - 24 Hours</h3>
                        <p class="text-gray-800">Ksh 20</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('250MB - 24 Hours', 20, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('250MB - 24 Hours', 20, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-yellow-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1GB - 24 Hours</h3>
                        <p class="text-gray-800">Ksh 99</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1GB - 24 Hours', 99, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1GB - 24 Hours', 99, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-red-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">2.5GB - 7 Days</h3>
                        <p class="text-gray-800">Ksh 300</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('2.5GB - 7 Days', 300, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('2.5GB - 7 Days', 300, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-red-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">6GB - 7 Days</h3>
                        <p class="text-gray-800">Ksh 700</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('6GB - 7 Days', 700, false)" class="btn-primary w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('6GB - 7 Days', 700, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">Data Offers - <span class="text-purple-600">Monthly Packages</span></h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1.2GB - 30 Days</h3>
                        <p class="text-gray-800">Ksh 250</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1.2GB - 30 Days', 250, false)" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1.2GB - 30 Days', 250, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">2.5GB - 30 Days</h3>
                        <p class="text-gray-800">Ksh 500</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('2.5GB - 30 Days', 500, false)" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('2.5GB - 30 Days', 500, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">10GB - 30 Days</h3>
                        <p class="text-gray-800">Ksh 1001</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('10GB - 30 Days', 1001, false)" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('10GB - 30 Days', 1001, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">8GB + 400 Min - 30 Days</h3>
                        <p class="text-gray-800">Ksh 1000</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('8GB + 400 Min - 30 Days', 1000, false)" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('8GB + 400 Min - 30 Days', 1000, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">300 Min - 30 Days</h3>
                        <p class="text-gray-800">Ksh 500</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('300 Min - 30 Days', 500, false)" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('300 Min - 30 Days', 500, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Airtime Services Section -->
        <div id="airtime-section" class="section section-hidden">
            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">Airtime Services</h3>
                
                <!-- Convert Airtime to Cash -->
                <div class="mb-8">
                    <h4 class="text-xl font-semibold text-green-600 mb-4">Convert Airtime to Cash</h4>
                    <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-lg p-6 shadow-md">
                        <div class="text-center mb-4">
                            <h5 class="text-lg font-bold text-gray-800">Get 80% Cash Back</h5>
                            <p class="text-gray-600">Convert your unused airtime to cash instantly</p>
                        </div>
                        <div class="max-w-md mx-auto">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Airtime Amount (Ksh)</label>
                                <input type="number" id="airtimeAmount" class="amount-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" placeholder="Enter amount" min="10">
                                <p class="text-sm text-gray-500 mt-1">You'll receive: <span id="cashBack" class="font-bold text-green-600">Ksh 0</span></p>
                            </div>
                            <button onclick="convertAirtime()" class="btn-primary w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium">Convert Airtime</button>
                        </div>
                    </div>
                </div>

                <!-- Buy Discounted Airtime -->
                <div class="mb-8">
                    <h4 class="text-xl font-semibold text-purple-600 mb-4">Buy Discounted Airtime</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center relative">
                            <div class="discount-badge">4% OFF</div>
                            <h3 class="text-lg font-bold">Airtime - Below Ksh 2000</h3>
                            <p class="text-gray-800">4% Discount</p>
                            <div class="mt-3">
                                <button onclick="buyDiscountedAirtime('below2000')" class="btn-primary w-full bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            </div>
                        </div>
                        <div class="bundle-card bg-purple-100 rounded-lg p-4 shadow-md text-center relative">
                            <div class="discount-badge">6% OFF</div>
                            <h3 class="text-lg font-bold">Airtime - Above Ksh 2000</h3>
                            <p class="text-gray-800">6% Discount</p>
                            <div class="mt-3">
                                <button onclick="buyDiscountedAirtime('above2000')" class="btn-primary w-full bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SMS Bundles Section -->
        <div id="sms-section" class="section section-hidden">
            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">SMS Bundle Offers</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bundle-card bg-orange-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">20 SMS - 24 Hours</h3>
                        <p class="text-gray-800">Ksh 5</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('20 SMS - 24 Hours', 5, false)" class="btn-primary w-full bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('20 SMS - 24 Hours', 5, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-orange-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">200 SMS - 24 Hours</h3>
                        <p class="text-gray-800">Ksh 10</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('200 SMS - 24 Hours', 10, false)" class="btn-primary w-full bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('200 SMS - 24 Hours', 10, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-orange-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1000 SMS - Weekly</h3>
                        <p class="text-gray-800">Ksh 30</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1000 SMS - Weekly', 30, false)" class="btn-primary w-full bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1000 SMS - Weekly', 30, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-orange-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1500 SMS - Monthly</h3>
                        <p class="text-gray-800">Ksh 100</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1500 SMS - Monthly', 100, false)" class="btn-primary w-full bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1500 SMS - Monthly', 100, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card bg-orange-100 rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">3500 SMS - Monthly</h3>
                        <p class="text-gray-800">Ksh 200</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('3500 SMS - Monthly', 200, false)" class="btn-primary w-full bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('3500 SMS - Monthly', 200, true)" class="btn-secondary w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Renewable Data Section -->
        <div id="renewable-section" class="section section-hidden">
            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">Renewable Data Offers - <span class="text-pink-600">Before Midnight</span></h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bundle-card renewable-card rounded-lg p-4 shadow-md text-center relative">
                        <div class="discount-badge">Save 20%</div>
                        <h3 class="text-lg font-bold">2GB - 24 Hours</h3>
                        <p class="text-white">Ksh 110</p>
                        <p class="text-xs text-pink-100 mb-3">Renewable before midnight</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('2GB - 24 Hours (Renewable)', 110, false)" class="btn-primary w-full bg-white text-pink-600 hover:bg-pink-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('2GB - 24 Hours (Renewable)', 110, true)" class="btn-secondary w-full bg-pink-200 hover:bg-pink-300 text-pink-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card renewable-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1.5GB - 3 Hours</h3>
                        <p class="text-white">Ksh 51</p>
                        <p class="text-xs text-pink-100 mb-3">Renewable before midnight</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1.5GB - 3 Hours (Renewable)', 51, false)" class="btn-primary w-full bg-white text-pink-600 hover:bg-pink-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1.5GB - 3 Hours (Renewable)', 51, true)" class="btn-secondary w-full bg-pink-200 hover:bg-pink-300 text-pink-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card renewable-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1GB - 1 Hour</h3>
                        <p class="text-white">Ksh 21</p>
                        <p class="text-xs text-pink-100 mb-3">Renewable before midnight</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyBundle('1GB - 1 Hour (Renewable)', 21, false)" class="btn-primary w-full bg-white text-pink-600 hover:bg-pink-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyBundle('1GB - 1 Hour (Renewable)', 21, true)" class="btn-secondary w-full bg-pink-200 hover:bg-pink-300 text-pink-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Minutes & Talktime Section -->
        <div id="minutes-section" class="section section-hidden">
            <div class="mb-6">
                <h3 class="text-2xl font-semibold text-blue-700 mb-4 text-center sm:text-left">Minutes & Talktime Offers</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bundle-card minutes-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">45 Minutes - 3 Hours</h3>
                        <p class="text-white">Ksh 22</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyMinutes('45 Minutes - 3 Hours', 22, false)" class="btn-primary w-full bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyMinutes('45 Minutes - 3 Hours', 22, true)" class="btn-secondary w-full bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card minutes-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">200 Bob Credit - Till Midnight</h3>
                        <p class="text-white">Ksh 52</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyMinutes('200 Bob Credit - Till Midnight', 52, false)" class="btn-primary w-full bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyMinutes('200 Bob Credit - Till Midnight', 52, true)" class="btn-secondary w-full bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card minutes-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">250 Minutes - 7 Days</h3>
                        <p class="text-white">Ksh 200</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyMinutes('250 Minutes - 7 Days', 200, false)" class="btn-primary w-full bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyMinutes('250 Minutes - 7 Days', 200, true)" class="btn-secondary w-full bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                    <div class="bundle-card minutes-card rounded-lg p-4 shadow-md text-center">
                        <h3 class="text-lg font-bold">1250 Minutes - 30 Days</h3>
                        <p class="text-white">Ksh 1000</p>
                        <div class="mt-3 space-y-2">
                            <button onclick="buyMinutes('1250 Minutes - 30 Days', 1000, false)" class="btn-primary w-full bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg font-medium">Buy Now</button>
                            <button onclick="buyMinutes('1250 Minutes - 30 Days', 1000, true)" class="btn-secondary w-full bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-2 rounded-lg font-medium text-sm">Buy for Another</button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 text-center text-sm text-blue-800 bg-blue-100 rounded shadow">
                    üìû For minutes orders, send money to <strong>0112223307</strong><br>
                    <span class="text-xs text-gray-600">Automation coming soon</span>
                </div>
            </div>
        </div>

        <div class="mt-10 p-4 text-center text-sm text-red-700 bg-yellow-200 rounded shadow">
            ‚ö†Ô∏è Kindly note: You can only purchase <strong>one package per day</strong>, and a new day begins at <strong>midnight</strong>.
        </div>

        <div class="mt-6 p-4 text-center text-sm text-green-900 bg-green-100 rounded shadow">
            üí≥ To purchase manually, send payment to <strong>Till Number: 4288958</strong><br>
            Recipient Name: <strong>Shem Kirimi</strong>
        </div>

        <div class="mt-10 p-4 text-center text-sm text-blue-800 bg-blue-100 rounded shadow">
            üõçÔ∏è Visit our <a href="https://sokoni.co.ke/" class="underline text-blue-900 font-semibold" target="_blank">main site Sokoni.co.ke</a> for more digital deals and offers.
        </div>
    </main>

    <!-- Purchase Modal -->
    <div id="purchaseModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-2xl max-w-md w-full p-6 relative">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Complete Purchase</h3>
                    <p id="bundleDetails" class="text-gray-600"></p>
                </div>

                <form id="purchaseForm" onsubmit="processPurchase(event)">
                    <!-- Recipient Phone Number (always shown) -->
                    <div class="mb-4">
                        <label for="recipientPhone" class="block text-sm font-medium text-gray-700 mb-2">
                            <span id="recipientLabel">Recipient's Phone Number</span>
                        </label>
                        <input 
                            type="tel" 
                            id="recipientPhone" 
                            class="phone-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none"
                            placeholder="0712345678"
                            maxlength="12"
                            required
                        >
                        <p id="recipientError" class="text-red-500 text-sm mt-1 hidden"></p>
                        <p class="text-gray-500 text-xs mt-1">Enter the Safaricom number to receive the bundle</p>
                    </div>

                    <!-- Payer Phone Number (only shown for "Buy for Another") -->
                    <div id="payerSection" class="mb-4 hidden">
                        <label for="payerPhone" class="block text-sm font-medium text-gray-700 mb-2">
                            Payer's Phone Number
                        </label>
                        <input 
                            type="tel" 
                            id="payerPhone" 
                            class="phone-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none"
                            placeholder="0712345678"
                            maxlength="12"
                        >
                        <p id="payerError" class="text-red-500 text-sm mt-1 hidden"></p>
                        <p class="text-gray-500 text-xs mt-1">Enter the phone number that will pay for this bundle</p>
                    </div>

                    <div class="flex space-x-3">
                        <button 
                            type="button" 
                            onclick="closeModal()" 
                            class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors"
                        >
                            Cancel
                        </button>
                        <button 
                            type="submit" 
                            id="purchaseBtn"
                            class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-colors flex items-center justify-center"
                        >
                            <span id="purchaseBtnText">Purchase Now</span>
                            <div id="purchaseSpinner" class="spinner ml-2 hidden"></div>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Airtime Modal -->
    <div id="airtimeModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay fixed inset-0" onclick="closeAirtimeModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-xl shadow-2xl max-w-md w-full p-6 relative">
                <button onclick="closeAirtimeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2" id="airtimeModalTitle">Buy Discounted Airtime</h3>
                    <p id="airtimeDetails" class="text-gray-600"></p>
                </div>

                <form id="airtimeForm" onsubmit="processAirtimePurchase(event)">
                    <div class="mb-4">
                        <label for="airtimeAmountInput" class="block text-sm font-medium text-gray-700 mb-2">
                            Airtime Amount (Ksh)
                        </label>
                        <input 
                            type="number" 
                            id="airtimeAmountInput" 
                            class="amount-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none"
                            placeholder="Enter amount"
                            min="1"
                            required
                        >
                        <p id="discountInfo" class="text-sm text-green-600 mt-1"></p>
                    </div>

                    <div class="mb-4">
                        <label for="airtimeRecipientPhone" class="block text-sm font-medium text-gray-700 mb-2">
                            Phone Number
                        </label>
                        <input 
                            type="tel" 
                            id="airtimeRecipientPhone" 
                            class="phone-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none"
                            placeholder="0712345678"
                            maxlength="12"
                            required
                        >
                        <p id="airtimeRecipientError" class="text-red-500 text-sm mt-1 hidden"></p>
                    </div>

                    <div class="flex space-x-3">
                        <button 
                            type="button" 
                            onclick="closeAirtimeModal()" 
                            class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors"
                        >
                            Cancel
                        </button>
                        <button 
                            type="submit" 
                            id="airtimePurchaseBtn"
                            class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium transition-colors flex items-center justify-center"
                        >
                            <span id="airtimePurchaseBtnText">Purchase Now</span>
                            <div id="airtimePurchaseSpinner" class="spinner ml-2 hidden"></div>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <a href="https://wa.me/254704166953" class="whatsapp-float" target="_blank" aria-label="Chat on WhatsApp">
        üí¨
    </a>

    <script>
        let currentBundle = null;
        let isForAnother = false;
        let currentAirtimeType = null;

        // Phone number formatting and validation
        function formatPhoneNumber(value) {
            // Remove all non-digits
            let digits = value.replace(/\D/g, '');
            
            // Handle different input formats
            if (digits.startsWith('254')) {
                digits = digits.slice(3); // Remove country code
            } else if (digits.startsWith('0')) {
                digits = digits.slice(1); // Remove leading zero
            }
            
            // Limit to 9 digits (after removing 0 or 254)
            digits = digits.slice(0, 9);
            
            return digits;
        }

        function validatePhoneNumber(phone) {
            const digits = formatPhoneNumber(phone);
            // Safaricom numbers: 7xxxxxxxx or 1xxxxxxxx (9 digits after removing 0)
            return /^[17]\d{8}$/.test(digits);
        }

        function displayPhoneNumber(phone) {
            const digits = formatPhoneNumber(phone);
            
            if (digits.length === 0) return '';
            
            // Always start with 0
            let formatted = '0' + digits;
            
            // Add spaces for better readability
            if (digits.length >= 3) {
                formatted = `0${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice(6)}`.trim();
            }
            
            return formatted;
        }

        // Setup phone input handlers
        function setupPhoneInput(inputId, errorId) {
            const phoneInput = document.getElementById(inputId);
            const phoneError = document.getElementById(errorId);

            phoneInput.addEventListener('input', function(e) {
                const cursorPosition = e.target.selectionStart;
                const oldValue = e.target.value;
                const newValue = displayPhoneNumber(e.target.value);
                
                // Update the input value
                e.target.value = newValue;
                
                // Restore cursor position (approximately)
                const lengthDiff = newValue.length - oldValue.length;
                const newCursorPosition = Math.min(cursorPosition + lengthDiff, newValue.length);
                e.target.setSelectionRange(newCursorPosition, newCursorPosition);
                
                // Validate only if user has entered something
                if (newValue.length > 1) {
                    if (!validatePhoneNumber(newValue)) {
                        phoneInput.classList.add('error');
                        phoneError.textContent = 'Please enter a valid Safaricom number (07xxxxxxxx or 01xxxxxxxx)';
                        phoneError.classList.remove('hidden');
                    } else {
                        phoneInput.classList.remove('error');
                        phoneError.classList.add('hidden');
                    }
                } else {
                    phoneInput.classList.remove('error');
                    phoneError.classList.add('hidden');
                }
            });

            phoneInput.addEventListener('keydown', function(e) {
                // Allow backspace, delete, tab, escape, enter
                if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
                    // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    // Allow home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

            phoneInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    const value = e.target.value;
                    e.target.value = displayPhoneNumber(value);
                }, 10);
            });
        }

        // Initialize phone inputs when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupPhoneInput('recipientPhone', 'recipientError');
            setupPhoneInput('payerPhone', 'payerError');
            setupPhoneInput('airtimeRecipientPhone', 'airtimeRecipientError');
            
            // Setup airtime amount calculator
            const airtimeAmountInput = document.getElementById('airtimeAmount');
            const cashBackSpan = document.getElementById('cashBack');
            
            airtimeAmountInput.addEventListener('input', function() {
                const amount = parseFloat(this.value) || 0;
                const cashBack = Math.floor(amount * 0.8);
                cashBackSpan.textContent = `Ksh ${cashBack}`;
            });
        });

        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.add('section-hidden'));
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('section-hidden');
            
            // Update tab buttons
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            toast.className = `toast ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg max-w-sm`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-1">${message}</div>
                    <button onclick="removeToast(this.parentElement.parentElement)" class="ml-4 text-white hover:text-gray-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => removeToast(toast), 5000);
        }

        function removeToast(toast) {
            toast.classList.add('toast-exit');
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.parentElement.removeChild(toast);
                }
            }, 300);
        }

        // Modal functions
        function buyBundle(bundleName, price, forAnother = false) {
            currentBundle = { name: bundleName, price: price };
            isForAnother = forAnother;
            
            document.getElementById('bundleDetails').textContent = `${bundleName} - Ksh ${price}`;
            
            // Update labels and visibility based on purchase type
            if (forAnother) {
                document.getElementById('recipientLabel').textContent = 'Recipient\'s Phone Number';
                document.getElementById('payerSection').classList.remove('hidden');
                document.getElementById('payerPhone').required = true;
            } else {
                document.getElementById('recipientLabel').textContent = 'Your Phone Number';
                document.getElementById('payerSection').classList.add('hidden');
                document.getElementById('payerPhone').required = false;
            }
            
            document.getElementById('purchaseModal').classList.remove('hidden');
            
            // Clear and focus the recipient phone input
            const recipientInput = document.getElementById('recipientPhone');
            const payerInput = document.getElementById('payerPhone');
            
            recipientInput.value = '';
            payerInput.value = '';
            recipientInput.classList.remove('error');
            payerInput.classList.remove('error');
            document.getElementById('recipientError').classList.add('hidden');
            document.getElementById('payerError').classList.add('hidden');
            
            setTimeout(() => recipientInput.focus(), 100);
        }

        function closeModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            document.getElementById('purchaseForm').reset();
            document.getElementById('recipientPhone').classList.remove('error');
            document.getElementById('payerPhone').classList.remove('error');
            document.getElementById('recipientError').classList.add('hidden');
            document.getElementById('payerError').classList.add('hidden');
        }

        // Airtime conversion
        function convertAirtime() {
            const amount = document.getElementById('airtimeAmount').value;
            if (!amount || amount < 10) {
                showToast('Please enter a valid amount (minimum Ksh 10)', 'error');
                return;
            }
            
            const cashBack = Math.floor(amount * 0.8);
            showToast(`To convert Ksh ${amount} airtime to Ksh ${cashBack} cash, please contact us on WhatsApp.`, 'info');
        }

        // Discounted airtime purchase
        function buyDiscountedAirtime(type) {
            currentAirtimeType = type;
            const discount = type === 'below2000' ? 4 : 6;
            
            document.getElementById('airtimeModalTitle').textContent = 'Buy Discounted Airtime';
            document.getElementById('airtimeDetails').textContent = `Get ${discount}% discount on airtime purchase`;
            
            // Setup amount input listener for discount calculation
            const amountInput = document.getElementById('airtimeAmountInput');
            const discountInfo = document.getElementById('discountInfo');
            
            amountInput.oninput = function() {
                const amount = parseFloat(this.value) || 0;
                const discountAmount = Math.floor(amount * (discount / 100));
                const finalAmount = amount - discountAmount;
                discountInfo.textContent = `You pay: Ksh ${finalAmount} (Save Ksh ${discountAmount})`;
            };
            
            document.getElementById('airtimeModal').classList.remove('hidden');
            setTimeout(() => amountInput.focus(), 100);
        }

        function closeAirtimeModal() {
            document.getElementById('airtimeModal').classList.add('hidden');
            document.getElementById('airtimeForm').reset();
            document.getElementById('airtimeRecipientPhone').classList.remove('error');
            document.getElementById('airtimeRecipientError').classList.add('hidden');
        }

        // Minutes purchase (manual process)
        function buyMinutes(bundleName, price, forAnother = false) {
            const recipient = forAnother ? 'recipient' : 'you';
            showToast(`For ${bundleName}, please send Ksh ${price} to 0112223307. The bundle will be sent to ${recipient}. Automation coming soon!`, 'info');
        }

        // Purchase processing
        async function processPurchase(event) {
            event.preventDefault();
            
            const recipientInput = document.getElementById('recipientPhone');
            const payerInput = document.getElementById('payerPhone');
            const recipientPhone = recipientInput.value;
            const payerPhone = payerInput.value;
            
            // Validate recipient phone
            if (!validatePhoneNumber(recipientPhone)) {
                recipientInput.classList.add('error');
                document.getElementById('recipientError').textContent = 'Please enter a valid Safaricom number';
                document.getElementById('recipientError').classList.remove('hidden');
                return;
            }

            // Validate payer phone if buying for another
            if (isForAnother) {
                if (!validatePhoneNumber(payerPhone)) {
                    payerInput.classList.add('error');
                    document.getElementById('payerError').textContent = 'Please enter a valid Safaricom number';
                    document.getElementById('payerError').classList.remove('hidden');
                    return;
                }
            }

            // Show loading state
            const purchaseBtn = document.getElementById('purchaseBtn');
            const purchaseBtnText = document.getElementById('purchaseBtnText');
            const purchaseSpinner = document.getElementById('purchaseSpinner');
            
            purchaseBtn.disabled = true;
            purchaseBtnText.textContent = 'Processing...';
            purchaseSpinner.classList.remove('hidden');

            try {
                // Format phone numbers for API (254xxxxxxxxx)
                const formattedRecipientPhone = '254' + formatPhoneNumber(recipientPhone);
                const formattedPayerPhone = isForAnother ? '254' + formatPhoneNumber(payerPhone) : formattedRecipientPhone;
                
                const response = await fetch('/stk-push', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: currentBundle.price,
                        phone: formattedPayerPhone, // The phone that will pay
                        recipientPhone: formattedRecipientPhone // The phone that will receive the bundle
                    })
                });

                const result = await response.json();

                if (response.ok && result.ResponseCode === '0') {
                    const message = isForAnother 
                        ? `Payment request sent to ${displayPhoneNumber(payerPhone)}! Bundle will be sent to ${displayPhoneNumber(recipientPhone)}.`
                        : `Payment request sent! Check your phone for M-Pesa prompt.`;
                    showToast(message, 'success');
                    closeModal();
                } else {
                    throw new Error(result.errorMessage || 'Payment failed');
                }
            } catch (error) {
                console.error('Purchase error:', error);
                showToast(`Purchase failed: ${error.message}`, 'error');
            } finally {
                // Reset loading state
                purchaseBtn.disabled = false;
                purchaseBtnText.textContent = 'Purchase Now';
                purchaseSpinner.classList.add('hidden');
            }
        }

        // Airtime purchase processing
        async function processAirtimePurchase(event) {
            event.preventDefault();
            
            const amountInput = document.getElementById('airtimeAmountInput');
            const phoneInput = document.getElementById('airtimeRecipientPhone');
            const amount = parseFloat(amountInput.value);
            const phone = phoneInput.value;
            
            // Validate amount based on type
            if (currentAirtimeType === 'below2000' && amount >= 2000) {
                showToast('For amounts above Ksh 2000, please select the 6% discount option', 'error');
                return;
            }
            
            if (currentAirtimeType === 'above2000' && amount < 2000) {
                showToast('For amounts below Ksh 2000, please select the 4% discount option', 'error');
                return;
            }
            
            // Validate phone
            if (!validatePhoneNumber(phone)) {
                phoneInput.classList.add('error');
                document.getElementById('airtimeRecipientError').textContent = 'Please enter a valid Safaricom number';
                document.getElementById('airtimeRecipientError').classList.remove('hidden');
                return;
            }

            // Calculate discount
            const discount = currentAirtimeType === 'below2000' ? 4 : 6;
            const discountAmount = Math.floor(amount * (discount / 100));
            const finalAmount = amount - discountAmount;

            // Show loading state
            const purchaseBtn = document.getElementById('airtimePurchaseBtn');
            const purchaseBtnText = document.getElementById('airtimePurchaseBtnText');
            const purchaseSpinner = document.getElementById('airtimePurchaseSpinner');
            
            purchaseBtn.disabled = true;
            purchaseBtnText.textContent = 'Processing...';
            purchaseSpinner.classList.remove('hidden');

            try {
                // Format phone number for API
                const formattedPhone = '254' + formatPhoneNumber(phone);
                
                const response = await fetch('/stk-push', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: finalAmount,
                        phone: formattedPhone,
                        recipientPhone: formattedPhone,
                        type: 'airtime',
                        originalAmount: amount,
                        discount: discount
                    })
                });

                const result = await response.json();

                if (response.ok && result.ResponseCode === '0') {
                    showToast(`Payment request sent! You'll receive Ksh ${amount} airtime for Ksh ${finalAmount} (${discount}% discount)`, 'success');
                    closeAirtimeModal();
                } else {
                    throw new Error(result.errorMessage || 'Payment failed');
                }
            } catch (error) {
                console.error('Airtime purchase error:', error);
                showToast(`Purchase failed: ${error.message}`, 'error');
            } finally {
                // Reset loading state
                purchaseBtn.disabled = false;
                purchaseBtnText.textContent = 'Purchase Now';
                purchaseSpinner.classList.add('hidden');
            }
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeAirtimeModal();
            }
        });
    </script>
</body>
</html>